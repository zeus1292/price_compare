<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retail Right - Smart Product Price Comparison</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üõçÔ∏è</text></svg>">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="/" class="logo">
                <span class="logo-icon">üõçÔ∏è</span>
                <span class="logo-text">Retail Right</span>
            </a>
            <div class="header-actions" id="header-actions">
                <!-- Auth buttons populated by JS -->
                <button class="auth-btn" id="login-btn" onclick="showAuthModal('login')">Log In</button>
                <button class="auth-btn primary" id="signup-btn" onclick="showAuthModal('signup')">Sign Up</button>
            </div>
            <div class="user-menu hidden" id="user-menu">
                <span class="user-name" id="user-name"></span>
                <button class="auth-btn" onclick="logout()">Log Out</button>
            </div>
        </div>
    </header>

    <div class="app-container">
        <main>
            <!-- Search Module -->
            <section class="search-module" id="search-module">
                <div class="search-body" id="search-body">
                    <form id="search-form" class="unified-search-form">
                        <!-- Main Input Area -->
                        <div class="input-row">
                            <div class="search-input-wrapper">
                                <input
                                    type="text"
                                    id="search-input"
                                    class="search-input"
                                    placeholder="Search for any product..."
                                    autocomplete="off"
                                >
                                <button type="button" class="camera-btn" id="camera-btn" title="Search by image">
                                    üì∑
                                </button>
                                <input type="file" id="image-input" accept="image/*" class="hidden">
                            </div>
                            <button type="submit" class="search-btn" id="search-btn">
                                Search
                            </button>
                        </div>

                        <!-- Image Drop Zone (hidden by default, shown when camera clicked) -->
                        <div class="image-drop-zone" id="image-drop-zone">
                            <div class="drop-zone-content" id="drop-zone-content">
                                <span class="drop-icon">üì∑</span>
                                <span class="drop-text">Drop an image here or click to upload</span>
                            </div>
                            <div class="image-preview-container hidden" id="image-preview-container">
                                <img id="image-preview" src="" alt="Preview">
                                <button type="button" class="remove-image-btn" id="remove-image-btn" title="Remove image">‚úï</button>
                            </div>
                        </div>

                        <!-- Search Options -->
                        <div class="search-options">
                            <label class="search-option">
                                <input type="checkbox" id="enable-live-search" checked>
                                <span>Live web search</span>
                            </label>
                            <label class="search-option">
                                <span>Min confidence:</span>
                                <input type="range" id="confidence-threshold" min="0" max="100" value="70">
                                <span class="threshold-value" id="threshold-value">70%</span>
                            </label>
                        </div>
                    </form>
                </div>
            </section>

            <!-- Recent Searches (for logged-in users) -->
            <section id="recent-searches-section" class="recent-searches-section hidden">
                <div class="section-header">
                    <h3 class="section-title">Recent Searches</h3>
                    <button class="clear-history-btn" onclick="clearSearchHistory()">Clear</button>
                </div>
                <div class="recent-searches-list" id="recent-searches-list">
                    <!-- Recent searches populated by JS -->
                </div>
            </section>

            <!-- Trending Categories -->
            <section id="trending-section" class="trending-section">
                <h3 class="section-title">Trending Categories</h3>
                <div class="carousel-container">
                    <button class="carousel-btn prev" onclick="scrollCarousel(-1)" id="carousel-prev">‚Äπ</button>
                    <div class="trending-carousel" id="trending-carousel">
                        <div class="category-card" onclick="searchCategory('Electronics')">
                            <span class="category-icon">üì±</span>
                            <span class="category-name">Electronics</span>
                        </div>
                        <div class="category-card" onclick="searchCategory('Fashion')">
                            <span class="category-icon">üëó</span>
                            <span class="category-name">Fashion</span>
                        </div>
                        <div class="category-card" onclick="searchCategory('Home & Kitchen')">
                            <span class="category-icon">üè†</span>
                            <span class="category-name">Home & Kitchen</span>
                        </div>
                        <div class="category-card" onclick="searchCategory('Beauty')">
                            <span class="category-icon">üíÑ</span>
                            <span class="category-name">Beauty</span>
                        </div>
                        <div class="category-card" onclick="searchCategory('Sports & Outdoors')">
                            <span class="category-icon">‚öΩ</span>
                            <span class="category-name">Sports & Outdoors</span>
                        </div>
                    </div>
                    <button class="carousel-btn next" onclick="scrollCarousel(1)" id="carousel-next">‚Ä∫</button>
                </div>
            </section>

            <!-- Loading Section -->
            <section id="loading-section" class="loading-section hidden">
                <div class="loading-spinner"></div>
                <h3 class="loading-title">Finding the best matches...</h3>
                <p class="loading-status" id="loading-status">Analyzing your query</p>
                <div class="loading-steps">
                    <div class="loading-step" id="step-extract">
                        <span class="step-indicator">1</span>
                        <span>Analyzing</span>
                    </div>
                    <div class="loading-step" id="step-search">
                        <span class="step-indicator">2</span>
                        <span>Searching</span>
                    </div>
                    <div class="loading-step" id="step-rank">
                        <span class="step-indicator">3</span>
                        <span>Ranking</span>
                    </div>
                </div>
                <p class="loading-time" id="loading-time"></p>
            </section>

            <!-- Error Section -->
            <section id="error-section" class="error-section hidden">
                <span class="error-icon">‚ö†Ô∏è</span>
                <p class="error-message" id="error-message"></p>
            </section>

            <!-- Results Section -->
            <section id="results-section" class="results-section hidden">
                <div class="results-header">
                    <h2 class="results-title">
                        <span class="results-title-icon">üì¶</span>
                        Matches Found
                    </h2>
                    <div class="results-controls">
                        <span class="results-meta-item" id="result-count">0 results</span>
                        <div class="sort-control">
                            <label for="sort-by">Sort by:</label>
                            <select id="sort-by" class="sort-select" onchange="handleSortChange()">
                                <option value="relevance">Relevance</option>
                                <option value="price_low_high">Price: Low to High</option>
                                <option value="price_high_low">Price: High to Low</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Results Grid -->
                <div class="results-grid" id="results-grid">
                    <!-- Product cards populated by JavaScript -->
                </div>
            </section>

            <!-- Contribute Section -->
            <section class="contribute-section">
                <button class="contribute-toggle" onclick="toggleContributeForm()">
                    <span>‚ûï</span>
                    <span>Add a Product</span>
                </button>
                <div id="contribute-form" class="contribute-form hidden">
                    <div class="contribute-header">
                        <h3 class="contribute-title">Add a Product to the Database</h3>
                        <p class="contribute-desc">Help improve search results by adding products you know about.</p>
                    </div>
                    <form id="product-contribute-form" onsubmit="submitProduct(event)">
                        <div class="contribute-grid">
                            <input type="text" id="contrib-name" class="contribute-input" placeholder="Product name *" required>
                            <input type="text" id="contrib-brand" class="contribute-input" placeholder="Brand">
                            <input type="number" id="contrib-price" class="contribute-input" placeholder="Price" step="0.01" min="0">
                            <input type="text" id="contrib-merchant" class="contribute-input" placeholder="Store/Merchant">
                            <input type="url" id="contrib-url" class="contribute-input" placeholder="Product page URL">
                            <input type="url" id="contrib-image" class="contribute-input" placeholder="Image URL">
                            <input type="text" id="contrib-category" class="contribute-input" placeholder="Category">
                        </div>
                        <div class="contribute-actions">
                            <button type="submit" class="contribute-btn">Add Product</button>
                        </div>
                    </form>
                    <div id="contribute-result" class="contribute-result hidden"></div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p class="footer-text">Powered by multi-agent AI with LangGraph</p>
            <div class="footer-links">
                <a href="/docs" target="_blank" class="footer-link">API Docs</a>
                <a href="/api/v1/search/metrics" target="_blank" class="footer-link">Metrics</a>
            </div>
        </footer>
    </div>

    <!-- Auth Modal -->
    <div class="modal-overlay hidden" id="auth-modal">
        <div class="modal">
            <button class="modal-close" onclick="hideAuthModal()">&times;</button>
            <div class="modal-header">
                <h2 class="modal-title" id="auth-modal-title">Log In</h2>
            </div>
            <div class="modal-body">
                <form id="auth-form" onsubmit="handleAuthSubmit(event)">
                    <div class="form-group hidden" id="name-group">
                        <label for="auth-name">Name</label>
                        <input type="text" id="auth-name" class="form-input" placeholder="Your name">
                    </div>
                    <div class="form-group">
                        <label for="auth-email">Email</label>
                        <input type="email" id="auth-email" class="form-input" placeholder="you@example.com" required>
                    </div>
                    <div class="form-group">
                        <label for="auth-password">Password</label>
                        <input type="password" id="auth-password" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6">
                    </div>
                    <div class="auth-error hidden" id="auth-error"></div>
                    <button type="submit" class="auth-submit-btn" id="auth-submit-btn">Log In</button>
                </form>
                <div class="auth-switch">
                    <span id="auth-switch-text">Don't have an account?</span>
                    <button type="button" class="auth-switch-btn" id="auth-switch-btn" onclick="toggleAuthMode()">Sign Up</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
</body>
</html>
